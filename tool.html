<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë¹„ì ë¶„ì„ ì‹œìŠ¤í…œ v1.4.0 (Auto-Survivial)</title>
    <style>
        :root { --primary: #2c3e50; --accent: #27ae60; --error: #c0392b; }
        body { font-family: 'Malgun Gothic', sans-serif; background: #f0f2f5; padding: 20px; display: flex; justify-content: center; }
        .app-container { width: 100%; max-width: 500px; background: white; border-radius: 12px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); padding: 25px; }
        h2 { text-align: center; color: var(--primary); margin-top: 0; }
        input, button { width: 100%; padding: 14px; margin-bottom: 12px; border-radius: 6px; border: 1px solid #ddd; box-sizing: border-box; font-size: 1rem; }
        button { background: var(--primary); color: white; border: none; font-weight: bold; cursor: pointer; transition: 0.2s; }
        button:hover { background: #34495e; }
        #status-box { background: #222; color: #0f0; padding: 15px; border-radius: 6px; font-size: 0.85rem; height: 200px; overflow-y: auto; white-space: pre-wrap; font-family: monospace; margin-top: 15px; display: none; }
        .log-err { color: #ff6b6b; }
        .log-ok { color: #51cf66; font-weight: bold; }
        .log-info { color: #ffd43b; }
        #result-area { margin-top: 20px; padding: 15px; background: #e8f5e9; border-left: 5px solid var(--accent); display: none; line-height: 1.6; }
    </style>
</head>
<body>

<div class="app-container">
    <h2>âš¡ VISA AI Auto-Connect</h2>
    
    <label>ğŸ” API í‚¤ (AI Studio)</label>
    <input type="password" id="apiKey" placeholder="ì—¬ê¸°ì— í‚¤ë¥¼ ì…ë ¥í•˜ì„¸ìš”">

    <label>ë¹„ì ì¢…ë¥˜</label>
    <input type="text" id="visaType" value="E-9">
    
    <button onclick="startSurvivalMode()">ğŸš€ ê°€ëŠ¥í•œ ëª¨ë¸ ì°¾ì•„ ë¶„ì„ ì‹œì‘</button>

    <div id="status-box">ëŒ€ê¸° ì¤‘...</div>
    <div id="result-area"></div>
</div>

<script>
    function log(msg, type = '') {
        const box = document.getElementById('status-box');
        box.style.display = 'block';
        let colorClass = '';
        if(type === 'error') colorClass = 'log-err';
        if(type === 'success') colorClass = 'log-ok';
        if(type === 'info') colorClass = 'log-info';
        
        box.innerHTML += `<div class="${colorClass}">> ${msg}</div>`;
        box.scrollTop = box.scrollHeight;
    }

    async function startSurvivalMode() {
        const key = document.getElementById('apiKey').value.trim();
        const visa = document.getElementById('visaType').value;
        const resultArea = document.getElementById('result-area');
        
        if (!key) return alert("API í‚¤ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.");
        
        document.getElementById('status-box').innerHTML = ""; // ì´ˆê¸°í™”
        resultArea.style.display = 'none';
        
        log("ğŸ” Google ì„œë²„ì— ì‚¬ìš© ê°€ëŠ¥í•œ ëª¨ë¸ ëª©ë¡ ìš”ì²­ ì¤‘...", "info");

        try {
            // 1. ëª¨ë¸ ëª©ë¡ ê°€ì ¸ì˜¤ê¸°
            const listRes = await fetch(`https://generativelanguage.googleapis.com/v1beta/models?key=${key}`);
            const listData = await listRes.json();

            if (listData.error) {
                log(`âŒ ëª©ë¡ ì¡°íšŒ ì‹¤íŒ¨: ${listData.error.message}`, "error");
                log("ğŸ’¡ íŒ: API í‚¤ê°€ ì•„ì˜ˆ í‹€ë ¸ê±°ë‚˜ ë§Œë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ìƒˆ í‚¤ë¥¼ ë°›ìœ¼ì„¸ìš”.", "info");
                return;
            }

            // generateContent ê¸°ëŠ¥ì„ ì§€ì›í•˜ëŠ” ëª¨ë¸ë§Œ í•„í„°ë§
            const viableModels = listData.models.filter(m => m.supportedGenerationMethods.includes("generateContent"));
            
            if (viableModels.length === 0) {
                log("âŒ ì‚¬ìš© ê°€ëŠ¥í•œ ëª¨ë¸ì´ í•˜ë‚˜ë„ ì—†ìŠµë‹ˆë‹¤.", "error");
                return;
            }

            log(`âœ… ëª¨ë¸ ${viableModels.length}ê°œ ë°œê²¬! ìˆœì°¨ ì ‘ì† ì‹œë„í•©ë‹ˆë‹¤.`, "success");

            // 2. ë°œê²¬ëœ ëª¨ë¸ë“¤ì„ í•˜ë‚˜ì”© ìˆœíšŒí•˜ë©° ì ‘ì† ì‹œë„
            const prompt = `ë‹¹ì‹ ì€ ì¶œì…êµ­ í–‰ì • ì „ë¬¸ê°€ì…ë‹ˆë‹¤. ${visa} ë¹„ìì— ëŒ€í•´ ê°„ëµíˆ ë¶„ì„í•´ì£¼ì„¸ìš”.`;
            let success = false;

            for (let modelInfo of viableModels) {
                const modelName = modelInfo.name.replace("models/", ""); // ì´ë¦„ ì •ì œ
                log(`--------------------------------`);
                log(`ğŸ“¡ [${modelName}] ì ‘ì† ì‹œë„...`);

                try {
                    const res = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/${modelName}:generateContent?key=${key}`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] })
                    });

                    const data = await res.json();

                    if (data.candidates && data.candidates[0].content) {
                        log(`ğŸ‰ ì„±ê³µ! [${modelName}]ì´(ê°€) ì‘ë‹µí–ˆìŠµë‹ˆë‹¤!`, "success");
                        resultArea.innerHTML = `<strong>[ë¶„ì„ ê²°ê³¼ - ${modelName}]</strong><br><br>` + data.candidates[0].content.parts[0].text;
                        resultArea.style.display = 'block';
                        success = true;
                        break; // ì„±ê³µí–ˆìœ¼ë‹ˆ ë°˜ë³µ ì¢…ë£Œ
                    } else if (data.error) {
                        // 429(Limit) ì—ëŸ¬ì¸ì§€ í™•ì¸
                        if (data.error.message.includes("quota") || data.error.message.includes("limit")) {
                            log(`â›” í•œë„ ì´ˆê³¼(ë¬´ë£Œì‚¬ìš©ëŸ‰ ë): ${modelName}`, "error");
                        } else {
                            log(`âš ï¸ ì‹¤íŒ¨: ${data.error.message}`, "error");
                        }
                    }
                } catch (e) {
                    log(`ğŸ’¥ ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜: ${modelName}`, "error");
                }
            }

            if (!success) {
                log(`--------------------------------`);
                log("âŒ [ìµœì¢… ì‹¤íŒ¨] ëª¨ë“  ëª¨ë¸ì´ ì‘ë‹µí•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.", "error");
                log("ğŸ’¡ [ì¡°ì¹˜ ë°©ë²•] ìœ„ ë¡œê·¸ì— 'quota'ë‚˜ 'limit'ë§Œ ê³„ì† ëœ¬ë‹¤ë©´, êµ¬ê¸€ ê³„ì •ì„ ìƒˆë¡œ íŒŒì„œ API í‚¤ë¥¼ ìƒˆë¡œ ë°›ëŠ” ê²ƒì´ ê°€ì¥ ë¹ ë¦…ë‹ˆë‹¤.", "info");
            }

        } catch (e) {
            log(`ì‹œìŠ¤í…œ ì˜¤ë¥˜: ${e.message}`, "error");
        }
    }
</script>

</body>
</html>
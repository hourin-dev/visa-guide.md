<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë¹„ì ë¶„ì„ ì‹œìŠ¤í…œ v1.3.0 (ì§„ë‹¨ëª¨ë“œ)</title>
    <style>
        :root { --primary: #2c3e50; --accent: #e74c3c; --bg: #ecf0f1; }
        body { font-family: 'Malgun Gothic', sans-serif; background: var(--bg); padding: 20px; display: flex; justify-content: center; }
        .app-container { width: 100%; max-width: 500px; background: white; border-radius: 10px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); padding: 25px; }
        h1 { text-align: center; color: var(--primary); margin-top: 0; }
        input, select, button { width: 100%; padding: 12px; margin-bottom: 10px; border-radius: 5px; border: 1px solid #ddd; box-sizing: border-box; }
        button.check-btn { background: #3498db; color: white; border: none; font-weight: bold; cursor: pointer; }
        button.run-btn { background: var(--primary); color: white; border: none; font-weight: bold; cursor: pointer; margin-top: 10px; }
        #log-area { background: #333; color: #0f0; padding: 15px; border-radius: 5px; font-size: 0.85rem; height: 150px; overflow-y: auto; white-space: pre-wrap; font-family: monospace; display: none; margin-top: 15px;}
        .highlight { color: #ffeb3b; font-weight: bold; }
    </style>
</head>
<body>

<div class="app-container">
    <h1>VISA AI v1.3.0</h1>
    
    <label>ğŸ” API í‚¤ ì…ë ¥</label>
    <input type="password" id="apiKey" placeholder="ì—¬ê¸°ì— API í‚¤ë¥¼ ë¶™ì—¬ë„£ìœ¼ì„¸ìš”">

    <button class="check-btn" onclick="checkMyModels()">1. ë‚´ í‚¤ë¡œ ì‚¬ìš© ê°€ëŠ¥í•œ ëª¨ë¸ ì¡°íšŒí•˜ê¸°</button>
    
    <hr style="margin: 20px 0; border: 0; border-top: 1px solid #eee;">

    <label>ë¹„ì ì¢…ë¥˜</label>
    <input type="text" id="visaType" value="E-9">
    
    <button class="run-btn" onclick="runAnalysis()">2. ë¶„ì„ ì‹œì‘ (ìë™ ëª¨ë¸ ì„ íƒ)</button>

    <div id="log-area">ëŒ€ê¸° ì¤‘...</div>
</div>

<script>
    // ë¡œê·¸ ì¶œë ¥ìš© í•¨ìˆ˜
    function log(msg, isError = false) {
        const area = document.getElementById('log-area');
        area.style.display = 'block';
        const color = isError ? '#ff6b6b' : '#0f0';
        area.innerHTML += `<span style="color:${color};"> > ${msg}</span>\n`;
        area.scrollTop = area.scrollHeight;
    }

    // 1. ëª¨ë¸ ì¡°íšŒ í•¨ìˆ˜ (ê°€ì¥ ì¤‘ìš”)
    async function checkMyModels() {
        const key = document.getElementById('apiKey').value.trim();
        if (!key) return alert("API í‚¤ë¥¼ ë¨¼ì € ì…ë ¥í•´ì£¼ì„¸ìš”.");
        
        document.getElementById('log-area').innerHTML = "--- ëª¨ë¸ ì¡°íšŒ ì‹œì‘ ---\n";
        
        try {
            log("ì„œë²„ì— í‚¤ ê¶Œí•œ í™•ì¸ ì¤‘...");
            const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models?key=${key}`);
            const data = await response.json();

            if (data.error) {
                log(`[ì¹˜ëª…ì  ì˜¤ë¥˜] í‚¤ê°€ ê±°ë¶€ë˜ì—ˆìŠµë‹ˆë‹¤: ${data.error.message}`, true);
                log("ğŸ’¡ í•´ê²°ì±…: í‚¤ê°€ ë§Œë£Œë˜ì—ˆê±°ë‚˜ ì˜ëª» ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤. AI Studioì—ì„œ ë‹¤ì‹œ ë°œê¸‰ë°›ìœ¼ì„¸ìš”.");
            } else {
                log(`âœ… ì¸ì¦ ì„±ê³µ! ì‚¬ìš© ê°€ëŠ¥í•œ ëª¨ë¸ ${data.models.length}ê°œ ë°œê²¬.`);
                log("--- ì§€ì›ë˜ëŠ” ëª¨ë¸ ëª©ë¡ ---");
                // generateContentë¥¼ ì§€ì›í•˜ëŠ” ëª¨ë¸ë§Œ í•„í„°ë§í•´ì„œ ë³´ì—¬ì¤Œ
                const usableModels = data.models.filter(m => m.supportedGenerationMethods.includes("generateContent"));
                
                usableModels.forEach(m => {
                    const shortName = m.name.replace("models/", "");
                    log(` - ${shortName}`);
                });
                
                log("\nğŸ’¡ ì´ì œ ì•„ë˜ 'ë¶„ì„ ì‹œì‘' ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ ìœ„ ëª¨ë¸ ì¤‘ ìµœì‹  ë²„ì „ì„ ìë™ìœ¼ë¡œ ì‚¬ìš©í•©ë‹ˆë‹¤.");
            }
        } catch (e) {
            log(`ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜: ${e.message}`, true);
        }
    }

    // 2. ë¶„ì„ ì‹¤í–‰ í•¨ìˆ˜
    async function runAnalysis() {
        const key = document.getElementById('apiKey').value.trim();
        if (!key) return alert("API í‚¤ê°€ í•„ìš”í•©ë‹ˆë‹¤.");
        
        // 2025ë…„ 12ì›” ê¸°ì¤€ ìœ íš¨í•œ ëª¨ë¸ë“¤
        const candidates = ["gemini-2.0-flash-exp", "gemini-1.5-flash-002", "gemini-1.5-flash"];
        const prompt = `ëŒ€í•œë¯¼êµ­ ë¹„ì(${document.getElementById('visaType').value}) ë¶„ì„ì„ í•´ì£¼ì„¸ìš”.`;

        log("\n--- ë¶„ì„ ìš”ì²­ ì‹œì‘ ---");

        for (let model of candidates) {
            log(`${model} ì—°ê²° ì‹œë„...`);
            try {
                const res = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/${model}:generateContent?key=${key}`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] })
                });
                const data = await res.json();

                if (data.candidates) {
                    log(`\nğŸ‰ ì„±ê³µ! [${model}] ì‘ë‹µ ìˆ˜ì‹  ì™„ë£Œ.`);
                    log("-----------------------------");
                    log(data.candidates[0].content.parts[0].text);
                    return; // ì„±ê³µ ì‹œ ì¢…ë£Œ
                } else {
                    log(`${model} ì‹¤íŒ¨: ${data.error?.message}`, true);
                }
            } catch (e) {
                log(`${model} ì—°ê²° ì‹¤íŒ¨`, true);
            }
        }
        log("âŒ ëª¨ë“  ëª¨ë¸ ì—°ê²° ì‹¤íŒ¨. ìœ„ 'ëª¨ë¸ ì¡°íšŒ'ë¥¼ ë¨¼ì € í•´ë³´ì„¸ìš”.", true);
    }
</script>

</body>
</html>
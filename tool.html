<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LawFirm ë¹„ì ì‚¬ê±´ ë¶„ì„ ì‹œìŠ¤í…œ v2.0</title>
    <style>
        :root { 
            --primary: #1a252f; /* ë³€í˜¸ì‚¬ ì‚¬ë¬´ì‹¤ ëŠë‚Œì˜ ì§™ì€ ë„¤ì´ë¹„ */
            --secondary: #34495e; 
            --accent: #c0392b; /* í¬ì¸íŠ¸ ì»¬ëŸ¬ (ì¤‘ìš” ì •ë³´) */
            --success: #27ae60;
            --bg: #ecf0f1;
        }
        body { font-family: 'Pretendard', 'Malgun Gothic', sans-serif; background: var(--bg); padding: 20px; display: flex; justify-content: center; color: #333; }
        
        .container { 
            width: 100%; max-width: 600px; 
            background: white; border-radius: 12px; 
            box-shadow: 0 15px 40px rgba(0,0,0,0.15); 
            overflow: hidden; 
        }

        .header { 
            background: var(--primary); color: white; 
            padding: 25px; text-align: center; 
        }
        .header h2 { margin: 0; font-size: 1.5rem; letter-spacing: -1px; }
        .header p { margin: 5px 0 0; font-size: 0.9rem; opacity: 0.8; }

        .content { padding: 30px; }

        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; font-weight: bold; margin-bottom: 8px; font-size: 0.95rem; color: var(--secondary); }
        .form-group input, .form-group select { 
            width: 100%; padding: 12px; 
            border: 1px solid #ddd; border-radius: 6px; 
            font-size: 1rem; box-sizing: border-box; transition: 0.3s;
        }
        .form-group input:focus { border-color: var(--primary); outline: none; }

        .row { display: flex; gap: 15px; }
        .col { flex: 1; }

        button { 
            width: 100%; padding: 16px; 
            background: var(--primary); color: white; 
            border: none; border-radius: 6px; 
            font-size: 1.1rem; font-weight: bold; cursor: pointer; 
            transition: background 0.3s; margin-top: 10px;
        }
        button:hover { background: #2c3e50; }
        
        /* ìƒíƒœ ë¡œê·¸ì°½ */
        #status-log { 
            margin-top: 20px; padding: 15px; 
            background: #222; color: #0f0; 
            font-family: monospace; font-size: 0.85rem; 
            border-radius: 6px; display: none; 
            max-height: 150px; overflow-y: auto;
        }

        /* ê²°ê³¼ì°½ */
        #result-box { 
            margin-top: 25px; display: none; 
            border: 1px solid #ddd; border-radius: 8px; overflow: hidden;
        }
        #result-header { background: #f8f9fa; padding: 15px; border-bottom: 1px solid #ddd; font-weight: bold; color: var(--primary); }
        #result-content { padding: 25px; line-height: 1.7; white-space: pre-wrap; font-size: 1rem; }

        .save-key-check { margin-top: 5px; font-size: 0.85rem; color: #666; display: flex; align-items: center; gap: 5px; }
    </style>
</head>
<body>

<div class="container">
    <div class="header">
        <h2>âš–ï¸ ì™¸êµ­ì¸ ì‚¬ê±´ ìˆ˜ì„ ë¶„ì„ê¸°</h2>
        <p>AI ê¸°ë°˜ ì²´ë¥˜ìê²© ë³€ê²½ ë° ì ìˆ˜ì œ ì •ë°€ ë¶„ì„</p>
    </div>

    <div class="content">
        <div class="form-group">
            <label>ğŸ” Google AI API Key</label>
            <input type="password" id="apiKey" placeholder="AIzaSy... í‚¤ë¥¼ ì…ë ¥í•˜ì„¸ìš”">
            <div class="save-key-check">
                <input type="checkbox" id="saveKey"> <label for="saveKey" style="display:inline; margin:0; font-weight:normal;">ì´ ë¸Œë¼ìš°ì €ì— í‚¤ ì €ì¥í•˜ê¸° (ì£¼ì˜: ê³µìš© PC ì œì™¸)</label>
            </div>
        </div>

        <hr style="border: 0; border-top: 1px solid #eee; margin: 25px 0;">

        <div class="row">
            <div class="col form-group">
                <label>í˜„ì¬ ë¹„ì (Status)</label>
                <input type="text" id="visaType" value="E-9" placeholder="ì˜ˆ: E-9, H-2">
            </div>
            <div class="col form-group">
                <label>ìƒë…„ì›”ì¼ (ë˜ëŠ” ë‚˜ì´)</label>
                <input type="text" id="age" value="1994ë…„ìƒ (31ì„¸)" placeholder="ì˜ˆ: 32ì„¸">
            </div>
        </div>

        <div class="row">
            <div class="col form-group">
                <label>ì—°ê°„ ì†Œë“ (Income)</label>
                <input type="number" id="income" value="3400" placeholder="ë‹¨ìœ„: ë§Œì›">
            </div>
            <div class="col form-group">
                <label>í•œêµ­ì–´ ëŠ¥ë ¥ (TOPIK)</label>
                <select id="koreanSkill">
                    <option value="ì—†ìŒ">ì—†ìŒ</option>
                    <option value="1ê¸‰">1ê¸‰</option>
                    <option value="2ê¸‰">2ê¸‰</option>
                    <option value="3ê¸‰" selected>3ê¸‰</option>
                    <option value="4ê¸‰">4ê¸‰</option>
                    <option value="5ê¸‰ ì´ìƒ">5ê¸‰ ì´ìƒ</option>
                    <option value="ì‚¬íšŒí†µí•© 4ë‹¨ê³„">ì‚¬íšŒí†µí•© 4ë‹¨ê³„ ì´ìˆ˜</option>
                    <option value="ì‚¬íšŒí†µí•© 5ë‹¨ê³„">ì‚¬íšŒí†µí•© 5ë‹¨ê³„ ì´ìˆ˜</option>
                </select>
            </div>
        </div>

        <div class="form-group">
            <label>ì¶”ê°€ íŠ¹ì´ì‚¬í•­ (ë²”ì£„ê²½ë ¥, í•™ë ¥ ë“±)</label>
            <input type="text" id="details" placeholder="ì˜ˆ: êµ­ë‚´ ì „ë¬¸ëŒ€ ì¡¸ì—…, ìŒì£¼ìš´ì „ ì´ë ¥ ì—†ìŒ" value="êµ­ë‚´ ì§€ë°©ëŒ€í•™ ì¡¸ì—…">
        </div>

        <button onclick="runAnalysis()">AI ì •ë°€ ë¶„ì„ ì‹¤í–‰</button>

        <div id="status-log">ì‹œìŠ¤í…œ ëŒ€ê¸° ì¤‘...</div>

        <div id="result-box">
            <div id="result-header">ğŸ“„ AI ë¶„ì„ ë³´ê³ ì„œ</div>
            <div id="result-content"></div>
        </div>
    </div>
</div>

<script>
    // í˜ì´ì§€ ë¡œë“œ ì‹œ ì €ì¥ëœ í‚¤ ë¶ˆëŸ¬ì˜¤ê¸°
    window.onload = function() {
        const savedKey = localStorage.getItem("myGeminiKey");
        if(savedKey) {
            document.getElementById('apiKey').value = savedKey;
            document.getElementById('saveKey').checked = true;
        }
    }

    function log(msg) {
        const box = document.getElementById('status-log');
        box.style.display = 'block';
        box.innerHTML += `> ${msg}\n`;
        box.scrollTop = box.scrollHeight;
    }

    async function runAnalysis() {
        const apiKey = document.getElementById('apiKey').value.trim();
        const visa = document.getElementById('visaType').value;
        const age = document.getElementById('age').value;
        const income = document.getElementById('income').value;
        const korean = document.getElementById('koreanSkill').value;
        const details = document.getElementById('details').value;
        const saveKeyCheck = document.getElementById('saveKey').checked;

        // í‚¤ ì €ì¥ ë¡œì§
        if(saveKeyCheck && apiKey) {
            localStorage.setItem("myGeminiKey", apiKey);
        } else {
            localStorage.removeItem("myGeminiKey");
        }

        if (!apiKey) return alert("API í‚¤ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.");

        // UI ì´ˆê¸°í™”
        document.getElementById('status-log').innerHTML = "--- ë¶„ì„ í”„ë¡œì„¸ìŠ¤ ì‹œì‘ ---\n";
        document.getElementById('result-box').style.display = 'none';
        
        // 1. ëª¨ë¸ íƒìƒ‰
        log("ğŸ” ì‚¬ìš© ê°€ëŠ¥í•œ AI ëª¨ë¸ íƒìƒ‰ ì¤‘...");
        
        try {
            const listRes = await fetch(`https://generativelanguage.googleapis.com/v1beta/models?key=${apiKey}`);
            const listData = await listRes.json();
            
            if(listData.error) throw new Error(listData.error.message);

            // í…ìŠ¤íŠ¸ ìƒì„±ì´ ê°€ëŠ¥í•œ ëª¨ë¸ë§Œ í•„í„°ë§
            const usableModels = listData.models.filter(m => m.supportedGenerationMethods.includes("generateContent"));
            
            if(usableModels.length === 0) throw new Error("ì‚¬ìš© ê°€ëŠ¥í•œ ëª¨ë¸ì´ ì—†ìŠµë‹ˆë‹¤.");
            
            log(`âœ… ${usableModels.length}ê°œì˜ ëª¨ë¸ ë°œê²¬. ìµœì  ëª¨ë¸ ì—°ê²° ì‹œë„...`);

            // 2. í”„ë¡¬í”„íŠ¸ ì‘ì„± (ì‚¬ë¬´ì¥ ì—…ë¬´ íŠ¹í™”)
            const prompt = `
                ë‹¹ì‹ ì€ ëŒ€í•œë¯¼êµ­ì˜ ìœ ëŠ¥í•œ ì¶œì…êµ­ ì „ë¬¸ í–‰ì •/ë²•ë¥  ì‚¬ë¬´ì¥ì…ë‹ˆë‹¤.
                ì•„ë˜ ì˜ë¢°ì¸ì˜ ì •ë³´ë¥¼ ë°”íƒ•ìœ¼ë¡œ [F-2-7 ì ìˆ˜ì œ ê±°ì£¼ ë¹„ì] ë³€ê²½ ê°€ëŠ¥ì„±ì„ ê³„ì‚°í•˜ê³ ,
                ë§Œì•½ ì ìˆ˜ê°€ ë¶€ì¡±í•˜ë‹¤ë©´ [E-7-4 ìˆ™ë ¨ê¸°ëŠ¥ì¸ë ¥] ë“± í˜„ì‹¤ì ì¸ ëŒ€ì•ˆì„ ì œì‹œí•´ ì£¼ì„¸ìš”.
                
                [ì˜ë¢°ì¸ ì •ë³´]
                - í˜„ì¬ë¹„ì: ${visa}
                - ë‚˜ì´/ìƒë…„: ${age}
                - ì—°ê°„ì†Œë“: ${income}ë§Œì›
                - í•œêµ­ì–´ëŠ¥ë ¥: ${korean}
                - ê¸°íƒ€ì‚¬í•­: ${details}

                [ë‹µë³€ ì–‘ì‹]
                1. **ì˜ˆìƒ ì ìˆ˜ ê³„ì‚°**: (F-2-7 ê¸°ì¤€, í•­ëª©ë³„ ì ìˆ˜ ë° ì´ì  ì¶”ì‚°)
                2. **ìŠ¹ì¸ ê°€ëŠ¥ì„± ì§„ë‹¨**: (ëƒ‰ì •í•œ í‰ê°€, ë°±ë¶„ìœ¨ í‘œê¸°)
                3. **ìˆ˜ì„ ì „ëµ ë° ë³´ì™„ì **: (ì†Œë“ ìš”ê±´, ì‚¬íšŒí†µí•©í”„ë¡œê·¸ë¨ ì´ìˆ˜ í•„ìš”ì„± ë“± êµ¬ì²´ì  ì¡°ì–¸)
                4. **ì£¼ì˜ì‚¬í•­**: (ë²”ì£„ ê²½ë ¥ ë“± ë¦¬ìŠ¤í¬ ìš”ì†Œ ì²´í¬)
            `;

            // 3. ìƒì¡´ ë£¨í”„ (ìˆœì°¨ ì ‘ì†)
            let success = false;
            
            for(let modelInfo of usableModels) {
                const modelName = modelInfo.name.replace("models/", "");
                log(`ğŸ“¡ [${modelName}] ëª¨ë¸ì— ë¶„ì„ ìš”ì²­ ì¤‘...`);

                try {
                    const res = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/${modelName}:generateContent?key=${apiKey}`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] })
                    });

                    const data = await res.json();

                    if(data.candidates && data.candidates[0].content) {
                        const resultText = data.candidates[0].content.parts[0].text;
                        
                        // ê²°ê³¼ ì¶œë ¥
                        document.getElementById('result-content').innerHTML = markdownToHtml(resultText);
                        document.getElementById('result-box').style.display = 'block';
                        document.getElementById('status-log').style.display = 'none'; // ë¡œê·¸ ìˆ¨ê¹€
                        success = true;
                        break; // ì„±ê³µ ì‹œ ë£¨í”„ ì¢…ë£Œ
                    } else if (data.error) {
                        log(`âš ï¸ ${modelName} ì‹¤íŒ¨: ${data.error.message}`);
                    }
                } catch (e) {
                    log(`ğŸ’¥ ${modelName} ì—°ê²° ì˜¤ë¥˜`);
                }
            }

            if(!success) {
                log("âŒ ëª¨ë“  ëª¨ë¸ ì—°ê²° ì‹¤íŒ¨. API í‚¤ì˜ í•œë„ë¥¼ í™•ì¸í•˜ì„¸ìš”.");
                alert("ë¶„ì„ ì‹¤íŒ¨: ë¬´ë£Œ ì‚¬ìš©ëŸ‰ì´ ì´ˆê³¼ë˜ì—ˆê±°ë‚˜ ë„¤íŠ¸ì›Œí¬ ë¬¸ì œì…ë‹ˆë‹¤.");
            }

        } catch (e) {
            log(`âŒ ì‹œìŠ¤í…œ ì˜¤ë¥˜: ${e.message}`);
            alert(`ì˜¤ë¥˜ ë°œìƒ: ${e.message}`);
        }
    }

    // ê°„ë‹¨í•œ ë§ˆí¬ë‹¤ìš´ -> HTML ë³€í™˜ (ë³´ê¸° ì¢‹ê²Œ ë§Œë“¤ê¸° ìœ„í•¨)
    function markdownToHtml(text) {
        return text
            .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>') // ë³¼ë“œ ì²˜ë¦¬
            .replace(/\n/g, '<br>'); // ì¤„ë°”ê¿ˆ ì²˜ë¦¬
    }
</script>

</body>
</html>